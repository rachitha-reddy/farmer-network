<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farmer Resources Lending</title>
<style>
  body {
    font-family: "Poppins", sans-serif;
    background-color: #f1faee;
    margin: 0;
    color: #1b5e20;
    padding: 0;
  }

  /* Left Sidebar styling */
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: 240px;
    background: #e8f5e9;
    border-top-right-radius: 20px;
    border-bottom-right-radius: 20px;
    box-shadow: 2px 0 8px rgba(44, 62, 80, 0.08);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    padding-top: 32px;
    z-index: 10;
  }

  .sidebar-brand {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding-left: 30px;
    margin-bottom: 36px;
  }
  .sidebar-brand img {
    width: 38px;
    height: 38px;
    margin-right: 13px;
    border-radius: 50%;
    background: #c8e6c9;
    padding: 4px;
  }
  .sidebar-brand span {
    font-size: 22px;
    font-weight: bold;
    color: #388e3c;
    letter-spacing: 1px;
    margin-left: 1px;
  }
  .sidebar-nav-link {
    color: #215424;
    padding: 14px 30px 14px 28px;
    margin: 7px 8px;
    width: calc(100% - 16px);
    border-radius: 8px;
    background: none;
    font-weight: 600;
    font-size: 18px;
    text-decoration: none;
    display: flex;
    align-items: center;
    transition: background 0.2s, color 0.2s;
    box-sizing: border-box;
  }
  .sidebar-nav-link i {
    margin-right: 16px;
    font-size: 19px;
  }
  .sidebar-nav-link.active,
  .sidebar-nav-link:hover {
    background-color: #c8e6c9;
    color: #1b5e20;
  }

  /* Main content with margin for sidebar */
  .container {
    margin-left: 260px;
    width: calc(100% - 280px);
    max-width: 950px;
    padding: 30px 0 40px 0;
  }

  header {
    background-color: #388e3c;
    color: white;
    text-align: center;
    padding: 22px 0 18px 0;
    font-size: 30px;
    font-weight: bold;
    margin-bottom: 32px;
    border-radius: 13px;
    width: 95%;
    margin-left: auto;
    margin-right: auto;
    box-shadow: 0 3px 8px rgba(44,62,80,0.04);
  }

  .section-title {
    text-align: center;
    margin: 40px 0 24px 0;
    font-size: 26px;
    text-decoration: underline;
    color: #2e7d32;
    font-weight: 600;
  }

  .resource-card {
    background-color: #fff;
    border-radius: 17px;
    box-shadow: 0 4px 18px rgba(60, 80, 60, 0.06);
    padding: 26px;
    margin-bottom: 24px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .resource-card:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 10px 24px rgba(36, 64, 48, 0.09);
  }
  .resource-card h3 {
    color: #2e7d32;
    font-size: 22px;
    margin-bottom: 10px;
  }
  .resource-card p {
    font-size: 17px;
    color: #33691e;
    margin-bottom: 8px;
  }
  .resource-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .resource-form input,
  .resource-form button {
    width: 100%;
    padding: 12px 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
    background: #fafafa;
    box-sizing: border-box;
  }
  .resource-form input:focus {
    outline: none;
    border-color: #2e7d32;
    background: #fff;
  }
  .resource-form button {
    background-color: #2e7d32;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.2s ease;
    border: none;
    margin-top: 5px;
  }
  .resource-form button:hover {
    background-color: #1b5e20;
  }
  footer {
    text-align: center;
    padding: 15px;
    background-color: #2e7d32;
    color: white;
    font-size: 16px;
    margin-top: 30px;
    margin-left: 240px;
    border-radius: 8px;
    width: calc(100% - 260px);
  }
</style>
<!-- FontAwesome CDN for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body>
<!-- Sidebar Nav -->
<div class="sidebar">
  <div class="sidebar-brand">
    <!-- Use the exact logo as on your weather page! -->
    <img src="img.jpg" alt="Logo">
    <span>Farmer Network</span>
  </div>
  <a href="index.html" class="sidebar-nav-link"><i class="fa fa-home"></i> Home</a>
  <a href="profile.html" class="sidebar-nav-link"><i class="fa fa-user"></i> Profile</a>
  <a href="messages.html" class="sidebar-nav-link"><i class="fa fa-envelope"></i> Messages</a>
  <a href="weather.html" class="sidebar-nav-link"><i class="fa fa-cloud-sun"></i> Weather</a>
  <a href="resources.html" class="sidebar-nav-link active"><i class="fa fa-book"></i> Resources</a>
  <a href="community.html" class="sidebar-nav-link"><i class="fa fa-users"></i> Community</a>
  <a href="tips.html" class="sidebar-nav-link"><i class="fa fa-lightbulb"></i> Tips</a>
  <a href="feedback.html" class="sidebar-nav-link"><i class="fa fa-star"></i> Feedback</a>
</div>

<div class="container">

  <header>ðŸšœ Farmer Resources Lending Hub ðŸšœ</header>

  <h2 class="section-title">Available Resources</h2>

  <!-- Resource card template (hidden, used for cloning) -->
  <div class="resource-card" id="resourceCardTemplate" style="display:none;">
    <h3 class="resource-name"></h3>
    <p><strong>Status:</strong> <span class="resource-status"></span></p>
    <p><strong>Owner:</strong> <span class="resource-owner"></span></p>
    <p><strong>Contact:</strong> <span class="resource-contact"></span></p>
    <p><strong>Location:</strong> <span class="resource-location"></span></p>
    <p><strong>Next Available:</strong> <span class="resource-next-available"></span></p>
  </div>

  <!-- Container where cards will be injected -->
  <div id="resourcesContainer"></div>

  <h2 class="section-title">Add a New Resource</h2>

  <div class="resource-card">
    <form id="resourceForm" class="resource-form">
      <input type="text" id="resName" placeholder="Resource name" required />
      <input type="text" id="resStatus" placeholder="Status (Available / Borrowed)" required />
      <input type="text" id="resOwner" placeholder="Owner name" required />
      <input type="text" id="resContact" placeholder="Contact number" required />
      <input type="text" id="resLocation" placeholder="Location" required />
      <input type="text" id="resNextAvailable" placeholder="Next available (e.g. Immediately)" required />
      <button type="submit">Add Resource</button>
    </form>
  </div>
</div>

<script>
  const API_BASE_URL = 'http://localhost:4000';
  
  // Check authentication
  const token = localStorage.getItem('token');
  if (!token) {
    window.location.href = 'login.html';
  }
  
  // Helper function to get auth headers
  function getAuthHeaders() {
    const token = localStorage.getItem('token');
    return {
      'Content-Type': 'application/json',
      ...(token ? { 'Authorization': `Bearer ${token}` } : {})
    };
  }

  const form = document.getElementById('resourceForm');
  const resourcesContainer = document.getElementById('resourcesContainer');
  const template = document.getElementById('resourceCardTemplate');

  // Load resources from backend and render
  async function loadResources() {
    try {
      const res = await fetch(`${API_BASE_URL}/api/resources`);
      
      if (!res.ok) {
        throw new Error('Failed to load resources');
      }
      
      const data = await res.json();
      const resources = data.resources || [];

      // Clear container
      resourcesContainer.innerHTML = '';

      // For each resource, clone the template and fill in data
      resources.forEach(resource => {
        const card = template.cloneNode(true);
        card.id = ''; // Remove the template ID
        card.style.display = 'block';
        
        // Fill in the data
        card.querySelector('.resource-name').textContent = resource.name || '';
        card.querySelector('.resource-status').textContent = resource.status || '';
        card.querySelector('.resource-owner').textContent = resource.owner || '';
        card.querySelector('.resource-contact').textContent = resource.contact || '';
        card.querySelector('.resource-location').textContent = resource.location || '';
        card.querySelector('.resource-next-available').textContent = resource.nextAvailable || '';
        
        // Append to container
        resourcesContainer.appendChild(card);
      });
    } catch (error) {
      console.error('Failed to load resources:', error);
      alert('Failed to load resources. Please try again.');
    }
  }

  // Load resources on page load
  document.addEventListener('DOMContentLoaded', () => {
    loadResources();
  });

  // Handle form submission
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Read values from input fields
    const resourceData = {
      name: document.getElementById('resName').value.trim(),
      status: document.getElementById('resStatus').value.trim(),
      owner: document.getElementById('resOwner').value.trim(),
      contact: document.getElementById('resContact').value.trim(),
      location: document.getElementById('resLocation').value.trim(),
      nextAvailable: document.getElementById('resNextAvailable').value.trim()
    };

    // Validate required fields
    if (!resourceData.name || !resourceData.status || !resourceData.owner || 
        !resourceData.contact || !resourceData.location || !resourceData.nextAvailable) {
      alert('Please fill in all fields');
      return;
    }

    try {
      const res = await fetch(`${API_BASE_URL}/api/resources`, {
        method: 'POST',
        headers: getAuthHeaders(),
        body: JSON.stringify(resourceData)
      });

      if (res.status === 401) {
        localStorage.removeItem('token');
        window.location.href = 'login.html';
        return;
      }

      if (!res.ok) {
        const error = await res.json();
        throw new Error(error.error || 'Failed to add resource');
      }

      // Clear form and reload resources
      form.reset();
      await loadResources();
    } catch (error) {
      console.error('Error adding resource:', error);
      alert('Failed to add resource: ' + error.message);
    }
  });
</script>

<footer>Â© 2025 Farmer-to-Farmer Knowledge Network ðŸŒ±</footer>
</body>
</html>
